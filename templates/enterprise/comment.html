{% extends 'enterprise/static/base.html' %}
{% load static %}
{% load humanize %}
{% block body %}

	<!-- Modal: Siparis Detayi -->
	<div class="modal fade" id="modal-detail">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title"> Sipariş Detayı</h4>
				</div>

				<div class="modal-body">
					<div id="modal-detail-content"></div>
				</div>
			
				<div class="modal-footer">
					<button type="button" class="btn btn-default btn-block" data-dismiss="modal">Kapat</button>
				</div>
			</div>
		</div>
	</div>


	<div class="content-wrapper">
		<div class="container">
			
			<section class="content-header">
				<h1>Yorumlar</h1>
				<ol class="breadcrumb">
					<li><a href="{% url 'enterprise:index' %}"><i class="fa fa-home"></i> Anasayfa</a></li>
					<li class="active">Yorumlar</li>
				</ol>
			</section>

			<section class="content">

				{% if messages %}
					{% for message in messages %}
						<div class="alert alert-success alert-dismissible" role="alert">
							<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							{{ message }}
						</div>
					{% endfor %}
				{% endif %}

				
				<div class="box box-primary">
					<div class="box-header">
						<h3 class="box-title">
							Yorumlar
							{% if comment|length != 0 %}
								({{comment|length}} tane)
							{% endif %}
						</h3>
					</div>

					<div class="box-body table-responsive">
						<table class="table table-hover">
							{% if comment|length == 0 %}
								<tr>
									<th>Şu anda hiç yorum yok!</th>
								</tr>
							{% endif %}
							{% if comment|length != 0 %}
								<tr>
									<th>Yorum</th>
									<th>Yorum Tarihi</th>
									<th>İşlemler</th>
								</tr>
								{% for singleLine in line %}
									{% if singleLine.comment.0 %}
										<tr>
											<!-- For Detail Modal -->
											<td class="orders" style="display: none;">
												<span style="font-size: 2rem; font-weight: 600">Sipariş</span><br>
												{% for item in singleLine.order %}
													<span style="font-size: 1.5rem">{{ item.count }} tane {{ item.menu.name }}</span>
													<br>
													{{ item.optionsReadable }}
													<br><br>
												{% endfor %}
												<span style="font-size: 2rem; font-weight: 600">Toplam Ücret</span><br>
												<span style="font-size: 1.5rem">{{ singleLine.totalPrice|floatformat:2 }} TL</span>
												<br><br>
												<span style="font-size: 2rem; font-weight: 600">Sipariş Zamanı</span><br>
												<span style="font-size: 1.5rem">{{ singleLine.orderDate|naturaltime }} - {{ singleLine.orderDate }}</span>
												<br><br>
												<span style="font-size: 2rem; font-weight: 600">Tamamlanma Zamanı</span><br>
												<span style="font-size: 1.5rem">{{ singleLine.complatedDate|naturaltime }} - {{ singleLine.complatedDate }}</span>
												<br><br>
												<span style="font-size: 2rem; font-weight: 600">Masa</span><br>
												<span style="font-size: 1.5rem">{{ singleLine.table.name }}</span>

												
											</td>

											<td>{{ singleLine.comment.0.comment }}</td>
											<td>{{ singleLine.comment.0.commentDate }}</td>
											<td>
												<button name="btn-detail" class="btn btn-default btn-sm">Sipariş Detayı</button>
											</td>

										</tr>
									{% endif %}
								{% endfor %}
							{% endif %}
						</table>
					</div>
						
				</div>
			</section>
		</div>
	</div>
{% endblock %}

{% block script %}
	<script type="text/javascript">


		$(document).ready(function(){

			// SHOW DETAILS

			$("button[name='btn-detail']").click(function(e){
				e.preventDefault();
				details = $(this).parents('tr').find('td.orders').html();

				console.log(details);
				
				$('#modal-detail-content').html(details);
				$('#modal-detail').modal('show');

			});



		});
	</script>
{% endblock %}
